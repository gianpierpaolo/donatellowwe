<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Donatello Wrestling Mayhem - Selettore Personaggi 16-bit</title>
    <!-- Caricamento di Tailwind CSS per uno stile moderno e responsivo -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Stile di base per il body e il font */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* Nero profondo per sfondo arena */
        }
        /* Look PIXELED WRESTLING ARENA (Bordo stile Cintura di Campione) */
        .arcade-border {
            border: 6px solid #FFC72C; /* Giallo Oro (Titolo) */
            box-shadow: 0 0 0 4px #E4002B, 0 0 20px rgba(228, 0, 43, 0.7); /* Rosso WWE */
            background: #1f2937; /* Grigio scuro/bluastro */
        }
        /* Stile per i box di selezione del personaggio */
        .selection-box {
            min-height: 250px;
            background-color: #111827; /* Nero profondo */
            border: 3px solid #6b7280; /* Bordo grigio */
            border-radius: 0.5rem; /* angoli arrotondati */
            box-shadow: 0 4px #4b5563; /* Effetto 3D leggero */
        }
        /* Stile per i pulsanti di selezione (piccole immagini in basso) */
        .character-thumbnail {
            width: 80px;
            height: 80px;
            object-fit: cover;
            transition: transform 0.1s;
            border: 3px solid transparent;
            cursor: pointer;
            image-rendering: pixelated;
        }
        .character-thumbnail:hover {
            transform: scale(1.1);
            border-color: #FFC72C; /* Effetto hover Oro */
        }
        .selected-p1 {
            border-color: #3b82f6 !important; /* Blu elettrico per P1 */
            box-shadow: 0 0 10px #3b82f6;
            transform: scale(1.15);
        }
        .selected-p2 {
            border-color: #ef4444 !important; /* Rosso vivo per P2 */
            box-shadow: 0 0 10px #ef4444;
            transform: scale(1.15);
        }
        /* Stile per l'immagine grande del personaggio */
        .character-portrait {
            width: 100%;
            height: 100%;
            object-fit: contain;
            image-rendering: pixelated;
        }
        /* Pulsante di combattimento (stile titolo dell'evento) */
        #fightButton {
            background-color: #E4002B; /* Rosso WWE */
            border: 3px solid #FFC72C; /* Bordo Oro */
            text-shadow: 1px 1px 0 #111827, 2px 2px 0 #111827;
            font-size: 1.5rem;
            padding-left: 2.5rem;
            padding-right: 2.5rem;
        }
        #fightButton:hover:not(:disabled) {
            background-color: #cc0025; /* Rosso piÃ¹ scuro */
            transform: translateY(-3px);
            box-shadow: 0 8px #FFC72C, 0 0 15px rgba(255, 199, 44, 0.8);
        }
        #fightButton:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            box-shadow: 0 4px #FFC72C;
        }

        /* Stile per la modal del risultato */
        .modal {
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 50;
        }
        .modal-content {
            animation: bounceIn 0.5s ease-out;
            border: 8px solid #E4002B; /* Bordo Rosso Vittoria */
            background-color: #111827;
        }
        /* Stile specifico per la modal di attesa */
        #loading-modal .modal-content {
            border: 8px solid #3b82f6; /* Bordo Blu Attesa */
            animation: none;
        }

        @keyframes bounceIn {
            0% { transform: scale(0.5); opacity: 0; }
            70% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(1); }
        }

        /* Look pixel art per il testo principale */
        .pixel-text {
            font-family: monospace;
            text-shadow: 3px 3px #000; /* Ombra piÃ¹ marcata */
        }

        /* Titolo Principale in Giallo WWE */
        h1.pixel-text {
            color: #FFC72C; 
            text-shadow: 4px 4px #E4002B; /* Oro su Rosso */
        }

        /* P1/P2 Pannello Headings */
        .selection-box h3 {
             text-shadow: 2px 2px #111827;
        }

        /* Stile per i pulsanti P1/P2 in evidenza */
        .player-selector-active {
            box-shadow: 0 0 15px #FFC72C;
            border-color: #FFC72C !important;
            transform: scale(1.05);
        }
        
        /* Assicura che le stelle appaiano bene */
        .star-rating {
            font-size: 1.4rem; /* Stelle leggermente piÃ¹ grandi */
            letter-spacing: 0.1em;
            color: #FFC72C; /* Stelle Giallo Oro */
            width: auto; 
            text-align: right;
        }

        /* Ajustments per P1 e P2 (solo stelle) */
        #p1-stats .flex { justify-content: space-between; }
        #p2-stats .flex { justify-content: space-between; }
    </style>
</head>
<body class="p-4 sm:p-8 flex flex-col items-center min-h-screen">
    
    <!-- ELEMENTO AUDIO NASCOSTO PER LA MUSICA DI SELEZIONE -->
    <audio id="selection-music" src="https://cdn.pixabay.com/download/audio/2025/09/18/audio_74a0fc77a1.mp3?filename=boooooooooooooooooss-406678.mp3" loop></audio>
    <!-- NUOVO ELEMENTO AUDIO NASCOSTO PER LA MUSICA DELL'INCONTRO -->
    <audio id="match-music" src="https://cdn.pixabay.com/download/audio/2025/09/20/audio_9cfdc87744.mp3?filename=chiptune-hibride-407598.mp3" loop></audio>

    <div class="arcade-border w-full max-w-6xl p-6 rounded-lg">
        <h1 class="text-4xl sm:text-5xl font-bold text-center mb-6 pixel-text">DONATELLO WRESTLING MAYHEM </h1>
        <h2 class="text-xl text-gray-200 text-center mb-4">Seleziona i tuoi Campioni</h2>
        
        <!-- SEZIONE DI SELEZIONE E STATISTICHE -->
        <div class="flex flex-col lg:flex-row justify-between gap-6 mb-4">

            <!-- Player 1 Panel -->
            <div id="p1-panel" class="lg:w-1/2 p-4 selection-box border-blue-600 border-4">
                <div class="flex items-center mb-4 justify-between">
                    <h3 class="text-2xl text-blue-400 font-bold pixel-text">PLAYER 1</h3>
                    <!-- Il pulsante di selezione P1 serve solo per lo stile attivo -->
                    <button id="p1-select-btn" disabled
                            class="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center text-sm font-bold text-white transition duration-150 border-2 border-blue-400">
                        P1
                    </button>
                </div>
                <div class="flex flex-col sm:flex-row gap-4">
                    <!-- Immagine grande P1 -->
                    <div class="w-full sm:w-1/2 h-48 sm:h-64 bg-gray-900 rounded-md overflow-hidden flex items-center justify-center">
                        <!-- Placeholder iniziale corretto -->
                        <img id="p1-portrait" class="character-portrait" src="https://placehold.co/256x256/1a202c/ffffff?text=P1" alt="Ritratto Player 1">
                    </div>
                    <!-- Statistiche P1 -->
                    <div id="p1-stats" class="w-full sm:w-1/2 text-white">
                        <p class="text-xl font-bold mb-2 text-red-400" id="p1-name">NOME: ?</p>
                        <div class="space-y-2 text-sm">
                            <!-- Forza (Solo Stelle) -->
                            <div class="flex items-center">
                                <span class="w-24 text-red-300">FORZA:</span>
                                <div id="p1-strength-stars" class="text-left font-bold pixel-text star-rating"></div>
                            </div>
                            <!-- VelocitÃ  (Solo Stelle) -->
                            <div class="flex items-center">
                                <span class="w-24 text-green-300">VELOCITÃ€:</span>
                                <div id="p1-speed-stars" class="text-left font-bold pixel-text star-rating"></div>
                            </div>
                            <!-- Resistenza (Solo Stelle) -->
                            <div class="flex items-center">
                                <span class="w-24 text-blue-300">RESISTENZA:</span>
                                <div id="p1-stamina-stars" class="text-left font-bold pixel-text star-rating"></div>
                            </div>
                            <!-- Carisma (Solo Stelle) -->
                            <div class="flex items-center">
                                <span class="w-24 text-yellow-300">CARISMA:</span>
                                <div id="p1-charisma-stars" class="text-left font-bold pixel-text star-rating"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Player 2 Panel -->
            <div id="p2-panel" class="lg:w-1/2 p-4 selection-box border-red-600 border-4">
                <div class="flex items-center mb-4 justify-between">
                    <!-- Il pulsante di selezione P2 serve solo per lo stile attivo -->
                    <button id="p2-select-btn" disabled
                            class="w-12 h-12 bg-red-600 rounded-full flex items-center justify-center text-sm font-bold text-white transition duration-150 border-2 border-red-400">
                        P2
                    </button>
                    <h3 class="text-2xl text-red-400 font-bold pixel-text">PLAYER 2</h3>
                </div>
                <div class="flex flex-col sm:flex-row-reverse gap-4">
                    <!-- Immagine grande P2 -->
                    <div class="w-full sm:w-1/2 h-48 sm:h-64 bg-gray-900 rounded-md overflow-hidden flex items-center justify-center">
                        <!-- Placeholder iniziale corretto -->
                        <img id="p2-portrait" class="character-portrait" src="https://placehold.co/256x256/1a202c/ffffff?text=P2" alt="Ritratto Player 2">
                    </div>
                    <!-- Statistiche P2 -->
                    <div class="w-full sm:w-1/2 text-white text-right">
                        <p class="text-xl font-bold mb-2 text-blue-400" id="p2-name">NOME: ?</p>
                        <div class="space-y-2 text-sm">
                            <!-- Forza (Solo Stelle) -->
                            <div class="flex items-center justify-end">
                                <div id="p2-strength-stars" class="text-right font-bold pixel-text star-rating"></div>
                                <span class="w-24 text-red-300">FORZA:</span>
                            </div>
                            <!-- VelocitÃ  (Solo Stelle) -->
                            <div class="flex items-center justify-end">
                                <div id="p2-speed-stars" class="text-right font-bold pixel-text star-rating"></div>
                                <span class="w-24 text-green-300">VELOCITÃ€:</span>
                            </div>
                            <!-- Resistenza (Solo Stelle) -->
                            <div class="flex items-center justify-end">
                                <div id="p2-stamina-stars" class="text-right font-bold pixel-text star-rating"></div>
                                <span class="w-24 text-blue-300">RESISTENZA:</span>
                            </div>
                            <!-- Carisma (Solo Stelle) -->
                            <div class="flex items-center justify-end">
                                <div id="p2-charisma-stars" class="text-right font-bold pixel-text star-rating"></div>
                                <span class="w-24 text-yellow-300">CARISMA:</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        
        <!-- Controlli Centrali (Status, Toggle, Fight) -->
        <div class="text-center mb-8 flex flex-col items-center">
            <p id="selection-status" class="text-xl font-bold mb-4 text-yellow-300 pixel-text">
                SELEZIONE ATTIVA: PLAYER 1
            </p>
            
            <div class="flex flex-col sm:flex-row gap-4 mb-6 justify-center">
                
                <!-- Pulsante Mute -->
                <button id="mute-button" onclick="toggleMusic()"
                        class="px-6 py-2 bg-purple-700 hover:bg-purple-600 text-white font-bold rounded-lg transition duration-150 uppercase border-2 border-purple-400 text-sm shadow-md">
                    AVVIA MUSICA ðŸ”Š
                </button>
            </div>

            <!-- PULSANTE COMBATTI -->
            <button id="fightButton" disabled
                    class="px-8 py-3 font-bold text-white rounded-full transition duration-150 uppercase shadow-lg disabled:opacity-60">
                SELEZIONA ENTRAMBI I LOTTATORI
            </button>
        </div>


        <!-- SELEZIONE PERSONAGGI (Thumbnail Grid) -->
        <h3 class="text-2xl text-yellow-300 text-center mb-4 font-bold pixel-text">ROSTER</h3>
        <div id="roster-grid" class="flex flex-wrap justify-center gap-4 p-4 arcade-border rounded-lg">
            <!-- Le miniature dei personaggi saranno iniettate qui dal JS -->
        </div>

    </div>

    <!-- MODAL 1: SCHERMATA MATCH IN CORSO (LOADING) -->
    <div id="loading-modal" class="modal fixed inset-0 flex items-center justify-center hidden">
        <div class="modal-content p-12 max-w-lg w-full rounded-xl text-center shadow-2xl">
            <h2 class="text-6xl font-extrabold text-blue-400 mb-6 pixel-text animate-pulse">
                MATCH IN CORSO...
            </h2>
            <!-- GIF WWE AGGIUNTA QUI -->
            <img src="https://media.tenor.com/4DQaO5KTUrYAAAAj/wwe-logo.gif" 
                 alt="WWE Logo Loading" 
                 class="w-32 h-32 mx-auto my-6 object-contain">
            
            <p class="text-xl text-white mt-4">Preparati alla distruzione!</p>
            <!-- Lo spinner Ã¨ stato rimosso in favore della GIF/GIF+testo -->
        </div>
    </div>


    <!-- MODAL 2: RISULTATO INCONTRO (WINNER) -->
    <div id="result-modal" class="modal fixed inset-0 flex items-center justify-center hidden">
        <div class="modal-content p-8 max-w-lg w-full rounded-xl text-center shadow-2xl">
            <h2 class="text-5xl font-extrabold text-yellow-400 mb-4 pixel-text">RISULTATO!</h2>
            
            <!-- Placeholder per l'immagine GIF -->
            <img id="winner-gif" class="w-full max-w-xs mx-auto my-4 rounded-lg shadow-xl" alt="Momento saliente dell'incontro" src="https://placehold.co/300x150/1a202c/ffffff?text=GIF">

            <div id="match-summary" class="text-white text-lg mb-6 leading-relaxed">
                <!-- Riepilogo dell'incontro -->
            </div>
            <p id="winner-announcement" class="text-3xl font-bold mb-8 text-green-400 uppercase pixel-text">
                <!-- Annuncio del vincitore -->
            </p>
            <button onclick="closeModal()" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded transition duration-150">
                Torna al Selettore
            </button>
        </div>
    </div>


    <script>
        // Array di oggetti per i personaggi del roster (omesso per brevitÃ , non modificato)
        const roster = [
            {
                name: "FLAVIO",
                small_img_url: "https://i.imgur.com/VyMOzzC.jpeg",
                large_img_url: "https://cdn.pixabay.com/animation/2025/12/06/15/49/15-49-04-523_256.gif",
                stats: { strength: 4, speed: 3, stamina: 1, charisma: 3 }
            },
            {
                name: "TASSO",
                small_img_url: "https://i.imgur.com/71J3O46.jpeg",
                large_img_url: "https://cdn.pixabay.com/animation/2025/12/06/15/49/15-49-04-361_256.gif",
                stats: { strength: 3, speed: 5, stamina: 4, charisma: 1 }
            },
            {
                name: "CASTEL",
                small_img_url: "https://i.imgur.com/TYtB1qL.jpeg",
                large_img_url: "https://cdn.pixabay.com/animation/2025/12/06/15/49/15-49-03-422_256.gif",
                stats: { strength: 2, speed: 4, stamina: 3, charisma: 3 }
            },
            {
                name: "STEFANO",
                small_img_url: "https://i.imgur.com/zBibAKl.jpeg",
                large_img_url: "https://cdn.pixabay.com/animation/2025/12/06/15/49/15-49-02-867_256.gif",
                stats: { strength: 3, speed: 5, stamina: 5, charisma: 4 }
            },
            {
                name: "FOSCHI",
                small_img_url: "https://i.imgur.com/7Zfe0Bp.jpeg",
                large_img_url: "https://cdn.pixabay.com/animation/2025/12/06/15/49/15-49-02-656_256.gif",
                stats: { strength: 2, speed: 2, stamina: 3, charisma: 4 }
            },
            {
                name: "PAOLO",
                small_img_url: "https://i.imgur.com/UZK6Ghd.jpeg",
                large_img_url: "https://cdn.pixabay.com/animation/2025/12/06/15/49/15-49-01-64_256.gif",
                stats: { strength: 3, speed: 3, stamina: 3, charisma: 3 }
            },
            {
                name: "ZAMPA",
                small_img_url: "https://i.imgur.com/pwOXi1q.jpeg",
                large_img_url: "https://cdn.pixabay.com/animation/2025/12/06/15/49/15-49-00-781_256.gif",
                stats: { strength: 3, speed: 3, stamina: 5, charisma: 5 }
            },
            {
                name: "TOMMY",
                small_img_url: "https://i.imgur.com/KgK4Pua.jpeg",
                large_img_url: "https://cdn.pixabay.com/animation/2025/12/06/15/49/15-49-00-87_256.gif",
                stats: { strength: 3, speed: 5, stamina: 5, charisma: 0 }
            },
            {
                name: "ASCIONE",
                small_img_url: "https://i.imgur.com/RQbSmT0.jpeg",
                large_img_url: "https://cdn.pixabay.com/animation/2025/12/06/15/48/15-48-59-874_256.gif",
                stats: { strength: 5, speed: 1, stamina: 2, charisma: 5 }
            },
            {
                name: "CIANI",
                small_img_url: "https://i.imgur.com/oH1H7AA.jpeg",
                large_img_url: "https://cdn.pixabay.com/animation/2025/12/06/15/48/15-48-58-488_256.gif",
                stats: { strength: 4, speed: 3, stamina: 4, charisma: 3 }
            },
            {
                name: "ANGELO",
                small_img_url: "https://i.imgur.com/Pfx4ycR.jpeg",
                large_img_url: "https://cdn.pixabay.com/animation/2025/12/06/15/48/15-48-55-570_256.gif",
                stats: { strength: 4, speed: 2, stamina: 2, charisma: 4 }
            }
        ];

        // Liste GIF e Descrizioni (omesse per brevitÃ , non modificate)
        const genericWinnerGifs = [
            "https://media.tenor.com/S-24Aapm_74AAAAM/big-show-paul-donald-wight-ii.gif",
            "https://media.tenor.com/esyQV4buNV4AAAAM/austin-theory-stone-cold.gif",
            "https://media.tenor.com/v2PhT0muq0IAAAAM/100.gif",
            "https://media.tenor.com/aGf6YP1ztKsAAAA1/logan-paul-cody-rhodes.webp",
            "https://media.tenor.com/vGclFLmKo1AAAAAM/brock-lesnar-wwe.gif",
            "https://media.tenor.com/aXkIz-vTZI4AAAAm/sleep-wwe.webp",
            "https://media.tenor.com/Rj3ZUiIeTkoAAAAM/undertaker-wwe.gif",
            "https://media.tenor.com/4v_AytYR5NkAAAAM/undertaker-brock.gif",
            "https://media.tenor.com/ngB68i7QKLsAAAA1/goldberg-charles-robinson.webp",
            "https://media.tenor.com/N-5vkrbVE8cAAAAM/wwe-goldberg.gif",
            "https://media.tenor.com/k681dBpXlBcAAAA1/goldberg-gunther.webp",
            "https://media.tenor.com/lGgvHfHsndEAAAAM/goldberg-jackhammer.gif",
            "https://media.tenor.com/r_HjtnG3VnAAAAAM/goldberg-spear.gif",
            "https://media.tenor.com/b-sMu_fiBXsAAAAM/goldberg-spear.gif"
        ];
        
        const tommyWinnerGifs = [
            "https://media1.tenor.com/m/4GVgj5QoTvwAAAAd/wwe-aj-styles.gif",
            "https://media1.tenor.com/m/9uGlZEzxXuAAAAAd/aj-styles-wwe.gif",
            "https://media1.tenor.com/m/C9PEvV0BQcAAAAAd/aj-styles-wwe-aj-styles.gif",
            "https://media1.tenor.com/m/PqOQqYOZqG8AAAAd/wwe-aj-styles.gif",
            "https://media1.tenor.com/m/QrDufB70N7cAAAAd/aj-styles-styles-clash.gif"
        ];
        
        const ascioneWinnerGifs = [ 
            "https://media1.tenor.com/m/VbQo4-uQIK4AAAAd/big-show-entrance.gif",
            "https://media1.tenor.com/m/-RUGRztc2qoAAAAd/wwe-world-wrestling-entertainment.gif",
            "https://media1.tenor.com/m/1-i1-EbI4IMAAAAd/matt-jackson-young-bucks.gif",
            "https://media1.tenor.com/m/6JaDLIKzOJkAAAAd/show-bar-cesaro.gif"
        ];
        const flavioWinnerGifs = [ 
            "https://media1.tenor.com/m/GZlSCVfe92QAAAAd/jbl-john-bradshaw-layfield.gif",
            "https://media1.tenor.com/m/DFKDx5PGkTsAAAAd/john-bradshaw-layfield-jbl.gif",
            "https://media1.tenor.com/m/x2R3uH2g0_AAAAAd/wrestling-wwe.gif",
            "https://media1.tenor.com/m/wnPUhLzlzqQAAAAd/john-bradshaw-layfield-jbl.gif",
            "https://media1.tenor.com/m/__tT1hXLigcAAAAd/jbl-entrance.gif"
        ];
        const zampaWinnerGifs = [ 
            "https://media1.tenor.com/m/ZsLd5yyNxoIAAAAd/the-undertaker-aj-styles.gif",
            "https://media1.tenor.com/m/hxiyT3JPRacAAAAd/wwe-wwe-smackdown.gif",
            "https://media1.tenor.com/m/P-BllVEAlfkAAAAd/the-undertaker-aj-styles.gif",
            "https://media1.tenor.com/m/hRt025P0HIMAAAAd/waking-up-anger.gif",
            "https://media1.tenor.com/m/xpk-IHT-t7QAAAAd/the-undertaker-chokeslam.gif"
        ];
        const angeloWinnerGifs = [ 
            "https://media1.tenor.com/m/TuA_OwJ1BdMAAAAd/eddie-guerrero-frog-splash.gif",
            "https://media1.tenor.com/m/XuJec8SKucwAAAAC/eddie-guerrero-wwe.gif",
            "https://media1.tenor.com/m/dA7UEt2yF1EAAAAd/eddie-guerrero-frog-splash.gif",
            "https://media1.tenor.com/m/64eM-DGLe_oAAAAd/eddie-guerrero-wwe.gif"
        ];
        const stefanoWinnerGifs = [ 
            "https://media1.tenor.com/m/OWhl9TvSqAIAAAAd/randy-orton-pose.gif",
            "https://media1.tenor.com/m/l2jvj-O7CMUAAAAd/randy-orton-rko.gif",
            "https://media1.tenor.com/m/k8EI7tNpVUMAAAAd/rko-wwe.gif",
            "https://media1.tenor.com/m/EKyHlha2SdcAAAAd/randy-orton-pose.gif"
        ];
        const paoloWinnerGifs = [ 
            "https://media1.tenor.com/m/g2-pIL6irMQAAAAd/stone-cold-steve-austin.gif",
            "https://media1.tenor.com/m/jKzHaFs44K0AAAAd/behold-me.gif",
            "https://media1.tenor.com/m/35hZ83zKFesAAAAd/stone-cold-steve-austin-entrance.gif",
            "https://media1.tenor.com/m/8uBc_KLcnloAAAAd/stone-cold-steve-austin-chairshot.gif",
            "https://media1.tenor.com/m/esyQV4buNV4AAAAd/austin-theory-stone-cold.gif",
            "https://media1.tenor.com/m/jg1yipA4-jIAAAAd/stone-cold-steve-austin-beer-bash.gif"
        ];
        const cianiWinnerGifs = [ 
            "https://media1.tenor.com/m/mD_XPfPW7goAAAAd/mick-foley-entrance.gif",
            "https://media1.tenor.com/m/usbxRbC88lIAAAAd/edge-spear.gif",
            "https://media1.tenor.com/m/TY6Wr7-jM6QAAAAd/dudelove-dude.gif",
            "https://media1.tenor.com/m/7ZjInbcpTbgAAAAd/mick-foley-elbow-drop.gif",
            "https://media1.tenor.com/m/g0Qp5zQMZFAAAAAd/mick-foley-barbed-wire-baseball-bat.gif"
        ];
        const tassoWinnerGifs = [ 
            "https://media1.tenor.com/m/EHNYe49VqJYAAAAd/chris-benoit-german-suplex.gif",
            "https://media1.tenor.com/m/9xIx7OmOcWgAAAAd/chris-benoit-belly-to-back-suplex.gif",
            "https://media1.tenor.com/m/3Kv7P5OXEnsAAAAd/chris-benoit-belly-to-back-suplex.gif",
            "https://media1.tenor.com/m/xZilRiuU_4oAAAAd/chris-benoit-crippler-crossface.gif",
            "https://media1.tenor.com/m/9xIx7OmOcWgAAAAd/chris-benoit-belly-to-back-suplex.gif",
            "https://media1.tenor.com/m/cFgcx9JpKmoAAAAd/chris-benoit-wwe.gif",
            "https://media1.tenor.com/m/ya9NkgY5BIQAAAAd/chris-benoit-pushups.gif",
            "https://media1.tenor.com/m/wQwUPYixHCMAAAAd/chris-benoit-diving-headbutt.gif",
            "https://media1.tenor.com/m/QrptYWHjOJUAAAAd/chris-benoit-crippler-crossface.gif"
        ];
        const foschiWinnerGifs = [ 
            "https://media1.tenor.com/m/qrN0wwCzhicAAAAd/daniel-bryan-yes.gif",
            "https://media1.tenor.com/m/TcsXPXvzWhgAAAAd/daniel-bryan-yes-lock.gif",
            "https://media1.tenor.com/m/Yho2FcmSDN8AAAAd/daniel-bryan-bryan-danielson.gif",
            "https://media1.tenor.com/m/cL841OZY-SMAAAAd/daniel-bryan-yes-kick.gif",
            "https://media1.tenor.com/m/tQTm41p1gqQAAAAd/daniel-bryan-running-knee.gif",
            "https://media1.tenor.com/m/DLbIM6a37d0AAAAd/daniel-bryan-running-knee.gif",
            "https://media1.tenor.com/m/sERkLPRkKUkAAAAd/daniel-bryan-stomps.gif"
        ];
        const castelWinnerGifs = [ 
            "https://media1.tenor.com/m/IYvoYX4QVzIAAAAd/bret-hart-wwf-champion.gif",
            "https://media1.tenor.com/m/ycaen8wP03IAAAAC/bret-hart-sharp-shooter.gif",
            "https://media1.tenor.com/m/lYhpm5HyARcAAAAd/bret-hart-hitman.gif",
            "https://media1.tenor.com/m/F44lh1Hiz4EAAAAd/bret-hart-superplex.gif",
            "https://media1.tenor.com/m/vECGEuhBxzQAAAAd/bret-hart-bret-the-hitman-hart.gif",
            "https://media1.tenor.com/m/CUfBMYBbyS4AAAAd/bret-hart-clothesline.gif",
            "https://media1.tenor.com/m/dEPOdvVfRLQAAAAd/bret-hart-piledriver.gif"
        ];
        
        // --- Descrizioni degli Incontri (omesse per brevitÃ , non modificate) ---
        const specificMatchDescriptions = {
            "FLAVIO": [ 
                (opponent) => `La folla ha urlato mentre **FLAVIO** caricava la sua devastante **Clothesline From Hell**! ${opponent} non ha avuto scampo contro la potenza del "Texas Millionaire". Ãˆ un K.O. dominato dalla Forza.`,
                (opponent) => `Flavio, con un atteggiamento arrogante da bullo ricco, ha colpito ${opponent} con una Powerbomb prima di umiliarlo con una serie di schiaffi. Vittoria prepotente e sporca per il "Big Man".`
            ],
            "TASSO": [ 
                (opponent) => `**TASSO** ha dominato l'incontro con una serie di **German Suplexes** che hanno scosso il ring! L'aggressivitÃ  del "Wolverine" ha costretto ${opponent} al tappeto, aprendo la strada al pin vincente.`,
                (opponent) => `In un finale tecnico, Tasso ha intrappolato ${opponent} nella sua micidiale **Crippler Crossface**! ${opponent} ha provato a resistere, ma l'agonismo e la precisione del "Cannibale" lo hanno costretto alla resa.`
            ],
            "CASTEL": [ 
                (opponent) => `La battaglia tecnica Ã¨ finita quando **CASTEL** ha rovesciato ${opponent} nella sua famigerata sottomissione, la **Sharpshooter**! ${opponent} non ha potuto far altro che battere la mano in segno di resa.`,
                (opponent) => `Dimostrazione di precisione: Castel ha colpito ${opponent} con una serie di colpi puliti e ha finalizzato l'incontro con un "Piledriver" perfetto, cementando il suo status di "Hitman".`
            ],
            "STEFANO": [ 
                (opponent) => `**RKO! RKO! RKO!** Stefano ha messo a segno la sua manovra finale **dal nulla**, cogliendo ${opponent} completamente di sorpresa. La "Vipera" non ha dato scampo.`,
                (opponent) => `Dopo aver dominato l'incontro con movimenti lenti e calcolati, Stefano ha sferrato il suo micidiale **Punt Kick**! ${opponent} Ã¨ rimasto a terra in stato confusionale. L'arbitro ha fermato l'incontro.`
            ],
            "FOSCHI": [ 
                (opponent) => `Tutto il pubblico ha scandito "**YES! YES! YES!**" mentre **FOSCHI** chiudeva l'incontro con una fulminea **Running Knee**! L'energia della folla ha alimentato la sua vittoria.`,
                (opponent) => `Foschi ha intrappolato ${opponent} nella sua micidiale **Yes Lock**! La pressione sul collo e sulla spalla era troppo forte. ${opponent} ha ceduto, e il "Capitano del Yes Movement" ha trionfato.`
            ],
            "PAOLO": [ 
                (opponent) => `**PAOLO** ha evitato un attacco e ha eseguito la sua manovra finale **dal nulla**, cogliendo ${opponent} completamente di sorpresa. La "Vipera" non ha dato scampo.`,
                (opponent) => `**PAOLO** ha evitato un attacco e ha eseguito la sua manovra finale **dal nulla**, cogliendo ${opponent} completamente di sorpresa. La "Vipera" non ha dato scampo.`,
                (opponent) => `Il "Texas Rattlesnake" Paolo ha dominato ${opponent} a suon di pugni e colpi proibiti. Dopo aver spaccato una sedia sull'avversario, ha chiuso il match con il pin, senza curarsi delle regole. *E quello Ã¨ l'bottom line!*`
            ],
            "ZAMPA": [ 
                (opponent) => `Le luci si sono spente e **ZAMPA** Ã¨ riapparso dietro ${opponent}! La sua **Chokeslam** ha squarciato il ring! ${opponent} Ã¨ stato poi sepolto con la micidiale **Tombstone Piledriver**.`,
                (opponent) => `L'incontro Ã¨ stato un lungo e oscuro massacro, con Zampa che ha incassato colpi apparentemente letali. L'essere soprannaturale si Ã¨ rialzato al conteggio di 2 e ha chiuso la pratica con un **Last Ride** terrificante.`
            ],
            "TOMMY": [ 
                (opponent) => `Ãˆ stato un duello **Phenomenal**! **TOMMY** ha messo a segno la **Styles Clash** dopo una rapida serie di manovre aeree. ${opponent} era troppo stordito per reagire!`,
                (opponent) => `Incredibile: Tommy ha spiccato il volo e ha colpito ${opponent} con la **Phenomenal Forearm**! Un colpo aereo di precisione chirurgica che ha messo fine all'incontro. Il "Phenomenal One" vince!`
            ],
            "ASCIONE": [ 
                (opponent) => `Il gigante **ASCIONE** ha resistito a tutto e ha messo fine all'incontro con un singolo, devastante **Knockout Punch**! ${opponent} Ã¨ crollato come un sacco di patate.`,
                (opponent) => `Ascione ha usato la sua mole per dominare ${opponent}. Dopo una serie di Body Slam, ha sollevato ${opponent} e lo ha scaraventato al tappeto con una **Chokeslam** imparabile.`
            ],
            "CIANI": [ 
                (opponent) => `**CIANI** ha tirato fuori da sotto il ring una mazza avvolta nel filo spinato! L'arbitro ha protestato, ma Ciani ha sferrato il colpo decisivo per il pin vincente. Caos totale!`,
                (opponent) => `Con la **Spear** a tutta velocitÃ , Ciani ha diviso in due ${opponent}, chiudendo l'incontro in pochi secondi. L'aggressivitÃ  e la sconsideratezza di Ciani lo hanno portato alla vittoria.`
            ],
            "ANGELO": [ 
                (opponent) => `**ANGELO** ha mostrato il suo "Latino Heat" e ha rubato la vittoria dopo un astuto stratagemma! Una volta che l'arbitro Ã¨ stato distratto, ha messo a segno la **Frog Splash** perfetta.`,
                (opponent) => `L'incontro si Ã¨ concluso con l'inganno. Angelo ha finto di essere infortunato, distraendo ${opponent}, per poi cogliere l'occasione e chiudere con un **Roll-up** rapido e vincente. *Â¡Viva la Raza!*`
            ]
        };

        const genericMatchDescriptions = [
            (p1Name, p2Name) => `Dopo una battaglia di **30 minuti** ad alta intensitÃ , ${p1Name} Ã¨ riuscito a connettere la sua mossa piÃ¹ devastante su ${p2Name}, chiudendo l'incontro in modo drammatico. Il pubblico Ã¨ in delirio!`,
            (p1Name, p2Name) => `L'arbitro Ã¨ andato al tappeto! ${p2Name} ha tentato di usare un oggetto contundente, ma ${p1Name} ha ribaltato la situazione all'ultimo secondo, ottenendo una vittoria sporca ma cruciale!`,
            (p1Name, p2Name) => `Incredibile dimostrazione di resistenza da parte di ${p1Name}, che ha incassato tre manovre di sottomissione da ${p2Name} prima di trovare l'energia per un Roll-up vincente!`,
            (p1Name, p2Name) => `Un match tecnico e veloce. ${p2Name} ha provato a dominare con la Forza, ma ${p1Name}, con la sua **VelocitÃ ** fulminea, ha evitato il colpo e ha messo a segno il pin vincente.`,
            (p1Name, p2Name) => `**Colpo di scena!** ${p1Name} sembrava spacciato, ma un guizzo di **Resistenza** gli ha permesso di uscire dalla sottomissione di ${p2Name} e ottenere il pin in contropiede.`,
        ];

        // Stato dell'applicazione
        let player1 = null; 
        let player2 = null; 
        let currentSelectionTarget = 1; 
        const MAX_STAT = 5;

        // Variabile per tenere traccia dello stato globale della musica (ON/OFF)
        let isMusicPlaying = false; 
        // TEMPO DI ATTESA RIDOTTO A 3 SECONDI
        const MINIMUM_DELAY_MS = 3000; 

        // Funzione helper per generare la stringa HTML delle stelle (omessa per brevitÃ , non modificata)
        function getStarRatingHtml(value, max) {
            const filledStar = 'â˜…'; 
            const emptyStar = 'â˜†'; 
            let html = '';
            for (let i = 1; i <= max; i++) {
                html += (i <= value) ? filledStar : emptyStar;
            }
            return html;
        }
        
        // NUOVA FUNZIONE: Avvia la musica di selezione se non Ã¨ giÃ  in riproduzione
        function startSelectionMusicIfMuted() {
            const selectionMusic = document.getElementById('selection-music');
            const muteButton = document.getElementById('mute-button');
            
            if (!isMusicPlaying) {
                selectionMusic.volume = 0.4;
                selectionMusic.play().then(() => {
                    isMusicPlaying = true;
                    muteButton.textContent = 'SPEGNI MUSICA ðŸ”‡';
                }).catch(error => {
                    console.error("Riproduzione audio fallita.", error);
                    // In caso di errore, il pulsante rimane su AVVIA, lo stato rimane false
                    muteButton.textContent = 'AVVIA MUSICA ðŸ”Š'; 
                });
            }
        }
        
        // FUNZIONE PER AVVIARE/SPEGNERE LA MUSICA (USATA SOLO DAL PULSANTE)
        function toggleMusic() {
            const selectionMusic = document.getElementById('selection-music');
            const matchMusic = document.getElementById('match-music');
            const muteButton = document.getElementById('mute-button');
            
            // Se la musica Ã¨ ON, spegni tutto e aggiorna lo stato
            if (isMusicPlaying) {
                selectionMusic.pause();
                matchMusic.pause();
                isMusicPlaying = false;
                muteButton.textContent = 'AVVIA MUSICA ðŸ”Š';
            } else {
                // Se la musica Ã¨ OFF, usa la funzione per avviarla (solo se spenta dal pulsante)
                startSelectionMusicIfMuted();
            }
        }
        
        // Funzione per cambiare la traccia audio in base alla fase del gioco
        function switchMusic(phase) {
            const selectionMusic = document.getElementById('selection-music');
            const matchMusic = document.getElementById('match-music');
            
            // Se la musica Ã¨ stata spenta dall'utente (isMusicPlaying=false), non facciamo nulla.
            if (!isMusicPlaying) return; 

            if (phase === 'match') {
                selectionMusic.pause();
                matchMusic.volume = 0.4;
                matchMusic.play().catch(e => console.error("Errore nell'avvio della musica dell'incontro:", e));
            } else if (phase === 'selection') {
                matchMusic.pause();
                selectionMusic.volume = 0.4;
                selectionMusic.play().catch(e => console.error("Errore nell'avvio della musica di selezione:", e));
            }
        }

        // Aggiorna l'indicatore di selezione P1/P2
        function updatePlayerSelectorDisplay() {
            const p1Btn = document.getElementById('p1-select-btn');
            const p2Btn = document.getElementById('p2-select-btn');
            const statusText = document.getElementById('selection-status');

            // Rimuovi la classe attiva da entrambi
            p1Btn.classList.remove('player-selector-active', 'border-yellow-400');
            p2Btn.classList.remove('player-selector-active', 'border-yellow-400');
            
            // Applica la classe attiva al target corrente
            if (currentSelectionTarget === 1) {
                p1Btn.classList.add('player-selector-active');
                statusText.textContent = 'SELEZIONE ATTIVA: PLAYER 1';
                p1Btn.classList.add('border-yellow-400'); // Evidenzia il pulsante P1
            } else {
                p2Btn.classList.add('player-selector-active');
                statusText.textContent = 'SELEZIONE ATTIVA: PLAYER 2';
                p2Btn.classList.add('border-yellow-400'); // Evidenzia il pulsante P2
            }
        }

        // Genera le miniature dei personaggi (omessa per brevitÃ , non modificata)
        function renderRoster() {
            const rosterGrid = document.getElementById('roster-grid');
            rosterGrid.innerHTML = ''; 

            roster.forEach(char => {
                const img = document.createElement('img');
                img.src = char.small_img_url;
                img.alt = char.name;
                img.title = `Clicca per assegnare ${char.name} a P${currentSelectionTarget}`;
                img.className = 'character-thumbnail rounded-md';
                img.dataset.name = char.name; 

                img.onerror = function() {
                    console.error(`Errore nel caricamento dell'immagine esterna per: ${char.name}. Uso placeholder.`);
                    this.src = `https://placehold.co/80x80/293241/ffffff?text=${char.name.substring(0, 3)}`; 
                };

                img.addEventListener('click', (e) => {
                    e.preventDefault(); 
                    selectCharacter(char); // Non passiamo piÃ¹ currentSelectionTarget
                });
                
                img.addEventListener('contextmenu', (e) => {
                    e.preventDefault(); 
                });

                rosterGrid.appendChild(img);
            });
        }

        // Seleziona un personaggio (LOGICA MODIFICATA per alternanza automatica)
        function selectCharacter(char) {
            const playerNum = currentSelectionTarget;

            if (playerNum === 1) {
                // Se P1 seleziona lo stesso di P2, deseleziona P2
                if (player2 && player2.name === char.name) {
                    player2 = null;
                    updatePlayerDisplay(2);
                }
                player1 = char;
                currentSelectionTarget = 2; // Passa a P2 per la prossima selezione
            } else { // playerNum === 2
                // Se P2 seleziona lo stesso di P1, deseleziona P1
                if (player1 && player1.name === char.name) {
                    player1 = null;
                    updatePlayerDisplay(1);
                }
                player2 = char;
                currentSelectionTarget = 1; // Passa a P1 per la prossima selezione
            }

            updatePlayerDisplay(playerNum);
            updateThumbnails();
            checkFightReadiness();
            updatePlayerSelectorDisplay(); // Aggiorna la visualizzazione dopo l'alternanza
        }

        // Aggiorna l'interfaccia di un giocatore (omessa per brevitÃ , non modificata)
        function updatePlayerDisplay(playerNum) {
            const player = playerNum === 1 ? player1 : player2;
            const prefix = `p${playerNum}`;

            document.getElementById(`${prefix}-name`).textContent = player ? `NOME: ${player.name}` : 'NOME: ?';
            document.getElementById(`${prefix}-portrait`).src = player ? player.large_img_url : `https://placehold.co/256x256/1a202c/ffffff?text=P${playerNum}`;
            document.getElementById(`${prefix}-portrait`).alt = player ? player.name : `Ritratto Player ${playerNum}`;

            const stats = player ? player.stats : { strength: 0, speed: 0, stamina: 0, charisma: 0 };

            Object.keys(stats).forEach(stat => {
                const value = stats[stat];
                const starsContainer = document.getElementById(`${prefix}-${stat}-stars`);
                if (starsContainer) {
                    starsContainer.textContent = getStarRatingHtml(value, MAX_STAT);
                }
            });
        }

        // Aggiorna i bordi delle miniature (omessa per brevitÃ , non modificata)
        function updateThumbnails() {
            document.querySelectorAll('.character-thumbnail').forEach(img => {
                img.classList.remove('selected-p1', 'selected-p2');

                if (player1 && img.dataset.name === player1.name) {
                    img.classList.add('selected-p1');
                }
                if (player2 && img.dataset.name === player2.name) {
                    img.classList.add('selected-p2');
                }
            });
        }

        // Abilita il pulsante "COMBATTI" (omessa per brevitÃ , non modificata)
        function checkFightReadiness() {
            const fightButton = document.getElementById('fightButton');
            fightButton.disabled = !(player1 && player2); 
            fightButton.textContent = (player1 && player2) ? `COMBATTI ${player1.name} VS ${player2.name}` : 'SELEZIONA ENTRAMBI I LOTTATORI';
        }

        // Funzione di simulazione aggiornata con il delay
        function simulateMatch() {
            if (!player1 || !player2) return;

            // 1. Disabilita il pulsante per evitare clic multipli
            document.getElementById('fightButton').disabled = true;

            // 2. Ferma la musica di selezione e avvia quella dell'incontro
            switchMusic('match'); 

            // 3. Mostra la modal di caricamento
            document.getElementById('loading-modal').classList.remove('hidden');

            // 4. Calcola il risultato (la logica di calcolo non richiede ritardi)
            const p1TotalScore = Object.values(player1.stats).reduce((sum, stat) => sum + stat, 0);
            const p2TotalScore = Object.values(player2.stats).reduce((sum, stat) => sum + stat, 0);

            let p1Bonus = 0;
            let p2Bonus = 0;

            if (p1TotalScore < p2TotalScore && player1.stats.charisma > 3) p1Bonus += 1;
            if (p2TotalScore < p1TotalScore && player2.stats.charisma > 3) p2Bonus += 1;

            if (player1.stats.stamina === MAX_STAT) p1Bonus += 1;
            if (player2.stats.stamina === MAX_STAT) p2Bonus += 1;

            const p1FinalScore = p1TotalScore + p1Bonus;
            const p2FinalScore = p2TotalScore + p2Bonus;

            const p1RandomMultiplier = Math.random() * 2.5 + 0.5; 
            const p2RandomMultiplier = Math.random() * 2.5 + 0.5; 

            const p1Chance = p1FinalScore * p1RandomMultiplier;
            const p2Chance = p2FinalScore * p2RandomMultiplier; 

            let winner = null;
            let summaryText;

            const absoluteDifference = Math.abs(p1Chance - p2Chance);
            const DRAW_THRESHOLD = 2.5; 

            if (absoluteDifference < DRAW_THRESHOLD) {
                winner = { name: "PAREGGIO" };
                summaryText = `I due lottatori si sono dati battaglia fino allo sfinimento! L'arbitro non ha avuto altra scelta che dichiarare un **Doppio K.O.** Nessun vincitore. Preparatevi per la rivincita!`;
            } else {
                const winningPlayer = p1Chance > p2Chance ? player1 : player2; 
                const losingPlayer = p1Chance > p2Chance ? player2 : player1; 
                winner = winningPlayer;

                let descriptions = specificMatchDescriptions[winner.name];
                
                if (!descriptions) {
                    descriptions = genericMatchDescriptions; 
                }

                const descFn = descriptions[Math.floor(Math.random() * descriptions.length)];
                summaryText = descFn(losingPlayer.name); 
            }

            // 5. Applica il ritardo (ORA 3000ms) prima di mostrare il risultato finale
            setTimeout(() => {
                // Nascondi la modal di caricamento
                document.getElementById('loading-modal').classList.add('hidden');
                // Mostra i risultati
                showResults(winner, summaryText);
                // Riabilita il pulsante (Viene riabilitato in closeModal, ma lo lasciamo qui per sicurezza)
                checkFightReadiness();
            }, MINIMUM_DELAY_MS);
        }

        // Mostra la modal dei risultati con l'immagine casuale (omessa per brevitÃ , non modificata)
        function showResults(winner, summaryHtml) {
            const modal = document.getElementById('result-modal');
            const winnerAnnouncement = document.getElementById('winner-announcement');
            const matchSummary = document.getElementById('match-summary');
            const gifElement = document.getElementById('winner-gif');
            
            let gifsToUse = genericWinnerGifs;

            if (winner.name === "TOMMY") { 
                gifsToUse = tommyWinnerGifs;
            } else if (winner.name === "CASTEL") { 
                gifsToUse = castelWinnerGifs;
            } else if (winner.name === "FOSCHI") {
                gifsToUse = foschiWinnerGifs;
            } else if (winner.name === "TASSO") {
                gifsToUse = tassoWinnerGifs;
            } else if (winner.name === "ASCIONE") {
                gifsToUse = ascioneWinnerGifs;
            } else if (winner.name === "FLAVIO") {
                gifsToUse = flavioWinnerGifs;
            } else if (winner.name === "ZAMPA") {
                gifsToUse = zampaWinnerGifs;
            } else if (winner.name === "ANGELO") {
                gifsToUse = angeloWinnerGifs; 
            } else if (winner.name === "STEFANO") {
                gifsToUse = stefanoWinnerGifs; 
            } else if (winner.name === "PAOLO") {
                gifsToUse = paoloWinnerGifs; 
            } else if (winner.name === "CIANI") {
                gifsToUse = cianiWinnerGifs; 
            } 

            const randomIndex = Math.floor(Math.random() * gifsToUse.length);
            gifElement.src = gifsToUse[randomIndex];
            
            if (winner.name === "PAREGGIO") {
                winnerAnnouncement.textContent = "Ãˆ un PAREGGIO!";
                winnerAnnouncement.classList.remove('text-green-400');
                winnerAnnouncement.classList.add('text-yellow-400');
                gifElement.classList.remove('opacity-50'); 
            } else {
                winnerAnnouncement.textContent = `IL VINCITORE Ãˆ ${winner.name}!`;
                winnerAnnouncement.classList.add('text-green-400');
                winnerAnnouncement.classList.remove('text-yellow-400');
                gifElement.classList.remove('opacity-50');
            }

            matchSummary.innerHTML = summaryHtml.replace(/\*\*(.*?)\*\*/g, '<span class="font-bold text-yellow-300">$1</span>');
            modal.classList.remove('hidden');
        }

        // Chiude la modal
        function closeModal() {
            document.getElementById('result-modal').classList.add('hidden');
            // Riabilita il pulsante Combatti
            checkFightReadiness(); 
            switchMusic('selection'); 
        }
        
        // Handler per l'avvio della musica al primo clic sul documento.
        function startMusicOnFirstClick() {
            startSelectionMusicIfMuted();
            // Rimuovi l'ascoltatore dopo il primo clic per evitare che riavvii l'audio ad ogni interazione.
            document.removeEventListener('click', startMusicOnFirstClick);
        }

        // Inizializzazione all'avvio
        document.addEventListener('DOMContentLoaded', () => {
            renderRoster(); 
            updatePlayerDisplay(1); 
            updatePlayerDisplay(2); 
            
            // Imposta il target iniziale e aggiorna la visualizzazione
            currentSelectionTarget = 1;
            updatePlayerSelectorDisplay(); 

            document.getElementById('fightButton').addEventListener('click', simulateMatch);
            checkFightReadiness(); 
            
            // Imposta il volume iniziale
            document.getElementById('selection-music').volume = 0.4;
            
            // Aggiunge l'ascoltatore di eventi al primo clic su tutto il documento per avviare l'audio
            document.addEventListener('click', startMusicOnFirstClick, { once: true });
        });
    </script>

</body>
</html>